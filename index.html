<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNTOOL - CLOUD VERIFIED</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #06080f;
            --brand-glow: rgba(59, 130, 246, 0.4);
        }
        body {
            background-color: var(--bg-color);
            color: #f8fafc;
            font-family: 'Plus Jakarta Sans', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .glass-card {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 420px;
            border-radius: 2.5rem;
            padding: 3rem;
            box-shadow: 0 40px 100px -20px rgba(0,0,0,0.8);
        }
        .btn-main {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            box-shadow: 0 10px 25px -5px var(--brand-glow);
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }
        .btn-main:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px -5px var(--brand-glow);
        }
        .btn-main:active:not(:disabled) {
            transform: translateY(0);
        }
        .btn-main:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-processing {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 10px 25px -5px rgba(245, 158, 11, 0.4);
        }
        .btn-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        .key-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px dashed rgba(59, 130, 246, 0.5);
            font-family: 'JetBrains Mono', monospace;
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fade-in-up 0.4s ease-out forwards;
        }
        .honeypot {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            margin-top: 1rem;
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .status-idle {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .status-processing {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        .status-success {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .turnstile-container {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="glass-card text-center">
        <!-- Logo Section -->
        <div style="width: 4rem; height: 4rem; background-color: #2563eb; border-radius: 1rem; margin: 0 auto 1.5rem; display: flex; align-items: center; justify-content: center; font-size: 1.875rem; font-weight: 900; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);">DN</div>
        
        <!-- Header Section -->
        <h1 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 0.25rem; font-style: italic;">DNTOOL <span style="color: #3b82f6; font-style: normal; font-weight: 300;">SYSTEM</span></h1>
        <p style="font-size: 0.625rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.3em; margin-bottom: 2.5rem; font-weight: 700;">H·ªá Th·ªëng X√°c Th·ª±c</p>

        <!-- Honeypot Fields (hidden traps for bots) -->
        <input type="text" id="website" class="honeypot" tabindex="-1" autocomplete="off">
        <input type="text" id="email" class="honeypot" tabindex="-1" autocomplete="off">
        <input type="text" id="phone" class="honeypot" tabindex="-1" autocomplete="off">
        
        <!-- Error Message Display -->
        <div id="errorMessage" class="hidden" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 0.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                <span id="errorText" style="color: #ef4444; font-size: 0.75rem;"></span>
            </div>
        </div>

        <!-- Status Indicator -->
        <div id="statusIndicator" class="status-indicator status-idle" style="width: 100%; justify-content: center; margin-bottom: 1rem;">
            <i class="fas fa-info-circle"></i>
            <span>S·∫µn s√†ng</span>
        </div>

        <!-- Step 1: Action Button -->
        <div id="step-1">
            <!-- Cloudflare Turnstile Widget -->
            <div class="turnstile-container">
                <div class="cf-turnstile" 
                     data-sitekey="0x4AAAAAACNwFP1me9pXoX_D" 
                     data-callback="onTurnstileSuccess"
                     data-error-callback="onTurnstileError"
                     data-theme="dark"
                     data-action="keygen"></div>
            </div>

            <button onclick="initiateKeyRequest()" id="btnAction" class="btn-main" style="width: 100%; padding: 1rem; border-radius: 1rem; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 0.75rem; transition: transform 0.2s; border: none;">
                <i id="btnIcon" class="fas fa-bolt"></i>
                <span id="btnText">NH·∫¨N M√É K√çCH HO·∫†T</span>
            </button>
            <p style="margin-top: 1.5rem; font-size: 0.6875rem; color: #64748b; line-height: 1.625; font-style: italic;">Y√™u c·∫ßu c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω an to√†n.</p>
        </div>

        <!-- Step 2: Result Display -->
        <div id="step-2" class="hidden animate-in">
            <div class="key-box" style="padding: 1.25rem; border-radius: 1rem; text-align: left;">
                <p style="font-size: 0.5625rem; color: #60a5fa; font-weight: 700; text-transform: uppercase; margin-bottom: 0.5rem;">Key c·ªßa b·∫°n:</p>
                <div id="resultKey" style="font-size: 0.875rem; font-weight: 700; color: white; word-break: break-all; margin-bottom: 1rem;">---</div>
                <button onclick="copyKeyToClipboard()" style="width: 100%; background-color: rgba(59, 130, 246, 0.1); padding: 0.75rem; border-radius: 0.75rem; font-size: 0.75rem; font-weight: 700; color: #60a5fa; transition: all 0.2s; border: 1px solid rgba(59, 130, 246, 0.2); cursor: pointer;">
                    SAO CH√âP NGAY
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const CONFIG = {
            SERVER_URL: 'https://dntool-worker.nguyendangnhi1704.workers.dev/',
            RATE_LIMIT: {
                maxRequests: 5,
                timeWindow: 60000 // 60 seconds
            },
            PROOF_OF_WORK: {
                difficulty: 4,
                enabled: true
            },
            TURNSTILE_SITE_KEY: '0x4AAAAAACNwFP1me9pXoX_D', // Updated to user's key
            APP_SESSION_ID: 'DN-2026-V1' // Must match server
        };

        // ===== STATE MANAGEMENT =====
        const securityState = {
            requestHistory: [],
            csrfToken: null,
            userInteractions: { mouse: 0, keyboard: 0 },
            sessionStart: Date.now(),
            turnstileToken: null,
            turnstileVerified: false
        };
        
        // ===== UI STATE MANAGEMENT =====
        const uiState = {
            currentStatus: 'idle', // idle, processing, error, success
            errorMessage: '',
            userId: null,
            userToken: null
        };
        
        // ===== UI HELPER FUNCTIONS =====
        function updateButtonState(status, text, icon) {
            const btnAction = document.getElementById('btnAction');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = statusIndicator.querySelector('span');
            const statusIcon = statusIndicator.querySelector('i');
            
            // Remove all state classes
            btnAction.classList.remove('btn-processing', 'btn-error', 'btn-success');
            statusIndicator.classList.remove('status-idle', 'status-processing', 'status-error', 'status-success');
            
            // Add new state classes and update content
            switch(status) {
                case 'processing':
                    btnAction.classList.add('btn-processing');
                    statusIndicator.classList.add('status-processing');
                    statusText.textContent = 'ƒêang x·ª≠ l√Ω';
                    statusIcon.className = 'fas fa-spinner fa-spin';
                    btnAction.disabled = true;
                    break;
                case 'error':
                    btnAction.classList.add('btn-error');
                    statusIndicator.classList.add('status-error');
                    statusText.textContent = 'L·ªói';
                    statusIcon.className = 'fas fa-exclamation-triangle';
                    btnAction.disabled = false;
                    break;
                case 'success':
                    btnAction.classList.add('btn-success');
                    statusIndicator.classList.add('status-success');
                    statusText.textContent = 'Th√†nh c√¥ng';
                    statusIcon.className = 'fas fa-check-circle';
                    btnAction.disabled = true;
                    break;
                default: // idle
                    statusIndicator.classList.add('status-idle');
                    statusText.textContent = 'S·∫µn s√†ng';
                    statusIcon.className = 'fas fa-info-circle';
                    btnAction.disabled = false;
            }
            
            // Update button text and icon
            if (text) btnText.innerHTML = text;
            if (icon) btnIcon.className = icon;
            
            uiState.currentStatus = status;
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
            uiState.errorMessage = message;
            
            // Auto-hide error after 5 seconds
            setTimeout(() => {
                errorDiv.classList.add('hidden');
                uiState.errorMessage = '';
            }, 5000);
        }
        
        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.add('hidden');
            uiState.errorMessage = '';
        }

        // ===== TURNSTILE CALLBACKS =====
        let turnstileLoaded = false;
        
        function onTurnstileSuccess(token) {
            console.log('Turnstile success:', token);
            securityState.turnstileToken = token;
            securityState.turnstileVerified = true;
            turnstileLoaded = true;
            
            // Enable button immediately after verification
            const btnAction = document.getElementById('btnAction');
            if (btnAction) {
                btnAction.disabled = false;
                btnAction.style.opacity = '1';
            }
        }

        function onTurnstileError() {
            console.error('Turnstile error');
            securityState.turnstileToken = null;
            securityState.turnstileVerified = false;
            turnstileLoaded = false;
            
            updateButtonState('error', '<i class="fas fa-exclamation-triangle"></i> L·ªñI X√ÅC TH·ª∞C', 'fas fa-exclamation-triangle');
            showError('X√°c th·ª±c Cloudflare th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
        }
        
        // Check if Turnstile is loaded
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (!turnstileLoaded) {
                    console.warn('Turnstile not loaded yet, enabling button anyway');
                    const btnAction = document.getElementById('btnAction');
                    if (btnAction) {
                        btnAction.disabled = false;
                    }
                }
            }, 3000);
        });

        // ===== RATE LIMITING =====
        function checkRateLimit() {
            const currentTime = Date.now();
            securityState.requestHistory = securityState.requestHistory.filter(
                timestamp => currentTime - timestamp < CONFIG.RATE_LIMIT.timeWindow
            );
            
            if (securityState.requestHistory.length >= CONFIG.RATE_LIMIT.maxRequests) {
                const oldestRequest = Math.min(...securityState.requestHistory);
                const waitTime = CONFIG.RATE_LIMIT.timeWindow - (currentTime - oldestRequest);
                throw new Error(`‚è±Ô∏è Qu√° nhi·ªÅu y√™u c·∫ßu! Vui l√≤ng ƒë·ª£i ${Math.ceil(waitTime/1000)} gi√¢y.`);
            }
            
            securityState.requestHistory.push(currentTime);
        }

        // ===== ANTI-BOT DETECTION =====
        function detectBotActivity() {
            const sessionDuration = Date.now() - securityState.sessionStart;
            
            // Check multiple honeypot fields
            const honeypotFields = ['website', 'email', 'phone'];
            for (const fieldId of honeypotFields) {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim() !== '') {
                    console.warn(`Honeypot field ${fieldId} filled:`, field.value);
                    return false;
                }
            }
            
            // Check session duration
            if (sessionDuration < 1000) {
                console.warn('Session too short:', sessionDuration);
                return false;
            }
            
            // Check user interactions
            if (sessionDuration > 2000 && securityState.userInteractions.mouse === 0 && securityState.userInteractions.keyboard === 0) {
                console.warn('No user interactions detected');
                return false;
            }
            
            // Check for common bot behaviors
            if (navigator.webdriver) {
                console.warn('WebDriver detected');
                return false;
            }
            
            return true;
        }

        // ===== INPUT VALIDATION =====
        function validateUserInput() {
            const urlParams = new URLSearchParams(window.location.search);
            const deviceId = urlParams.get('id');
            const userToken = urlParams.get('token');

            if (!deviceId) {
                showError('THI·∫æU TH√îNG TIN - Vui l√≤ng th√™m ?id=DEVICE_ID v√†o URL')
                return false;
            }

            // Parse user_id from userToken (format: userId-deviceId)
            let userId = null;
            if (userToken && userToken.includes('-')) {
                const parts = userToken.split('-');
                userId = parseInt(parts[0]);
                if (isNaN(userId) || userId <= 0) {
                    userId = null;
                }
            }

            // Store for later use
            uiState.userId = userId;
            uiState.userToken = userToken;

            // Validate user ID
            if (!userId || userId.toString().trim() === '') {
                showError('USER ID kh√¥ng h·ª£p l·ªá - ƒê·ªô d√†i ph·∫£i t·ª´ 3-50 k√Ω t·ª±')
                return false;
            }
            
            // Validate user ID format (basic check)
            if (userId.toString().length < 3 || userId.toString().length > 50) {
                showError('USER ID kh√¥ng h·ª£p l·ªá - ƒê·ªô d√†i ph·∫£i t·ª´ 3-50 k√Ω t·ª±')
                return false;
            }
            
            // Check for suspicious characters
            const suspiciousPattern = /[<>"'&]/;
            if (suspiciousPattern.test(userId.toString())) {
            if (suspiciousPattern.test(userId)) {
                showError('USER ID ch·ª©a k√Ω t·ª± kh√¥ng h·ª£p l·ªá');
                return false;
            }
            
            return true;
        }

        // ===== PROOF OF WORK =====
        async function generateProofOfWork(challenge) {
            if (!CONFIG.PROOF_OF_WORK.enabled) {
                return 'disabled';
            }

            const difficulty = CONFIG.PROOF_OF_WORK.difficulty;
            const target = '0'.repeat(difficulty);
            let nonce = 0;
            let hash = '';

            while (true) {
                const input = challenge + nonce;
                const encoder = new TextEncoder();
                const data = encoder.encode(input);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

                if (hash.startsWith(target)) {
                    return { nonce, hash };
                }

                nonce++;

                if (nonce > 1000000) {
                    throw new Error('Proof of work timeout');
                }
            }
        }

        // ===== ENDPOINT SIGNATURE =====
        async function generateEndpointSignature(endpoint, timestamp, deviceId) {
            const secret = CONFIG.APP_SESSION_ID;
            const combined = `${endpoint}:${timestamp}:${deviceId}`;
            
            const encoder = new TextEncoder();
            const keyData = encoder.encode(secret);
            const messageData = encoder.encode(combined);
            
            const cryptoKey = await crypto.subtle.importKey(
                'raw',
                keyData,
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign']
            );
            
            const signatureBuffer = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
            const signature = Array.from(new Uint8Array(signatureBuffer))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
            
            return signature;
        }

        // ===== MAIN REQUEST FUNCTION =====
        async function initiateKeyRequest() {
            // Hide any previous errors
            hideError();
            
            // Validate user input first
            if (!validateUserInput()) {
                updateButtonState('error', '<i class="fas fa-exclamation-triangle"></i> THI·∫æU TH√îNG TIN', 'fas fa-exclamation-triangle');
                setTimeout(() => {
                    updateButtonState('idle', '<i class="fas fa-bolt"></i> NH·∫¨N M√É K√çCH HO·∫†T', 'fas fa-bolt');
                }, 3000);
                return;
            }
            
            // Check Turnstile verification (more lenient)
            if (!turnstileLoaded && (!securityState.turnstileVerified || !securityState.turnstileToken)) {
                console.warn('Turnstile not verified, proceeding anyway');
            }
            
            // Update UI to processing state
            updateButtonState('processing', '<i class="fas fa-spinner fa-spin"></i> ƒêANG X·ª¨ L√ù...', 'fas fa-spinner fa-spin');
            
            try {
                checkRateLimit();
                
                if (!detectBotActivity()) {
                    throw new Error('ü§ñ Ph√°t hi·ªán ho·∫°t ƒë·ªông b·∫•t th∆∞·ªùng. Vui l√≤ng th·ª≠ l·∫°i sau v√†i gi√¢y.');
                }

                const deviceId = getDeviceFingerprint();
                const timestamp = Date.now().toString();
                const endpoint = '/github/generate_24h_key';
                
                if (!securityState.csrfToken) {
                    securityState.csrfToken = generateCSRFToken();
                }

                updateButtonState('processing', '<i class="fas fa-spinner fa-spin"></i> ƒêANG X√ÅC TH·ª∞C...', 'fas fa-spinner fa-spin');
                const powChallenge = timestamp + deviceId;
                const proofOfWork = await generateProofOfWork(powChallenge);
                
                // Generate endpoint signature
                const endpointSignature = await generateEndpointSignature(endpoint, timestamp, deviceId);

                const payload = {
                    action: 'generate_24h_key',
                    module: 'github',
                    user_id: uiState.userId, // Use validated user ID
                    key_input: uiState.userToken || 'DEMO-KEY-12345',
                    device_id: deviceId,
                    csrf_token: securityState.csrfToken,
                    user_agent: navigator.userAgent,
                    timestamp: timestamp,
                    proof_of_work: proofOfWork,
                    turnstile_token: securityState.turnstileToken,
                    endpoint: endpoint,
                    endpoint_signature: endpointSignature,
                    auth_key: 'Mat_Ma_Sieu_Cap_123_be_tap_code_vip_pro_chong_hack_ha_ha' // Required auth key
                };

                updateButtonState('processing', '<i class="fas fa-spinner fa-spin"></i> ƒêANG K·∫æT N·ªêI...', 'fas fa-spinner fa-spin');
                const response = await fetch(CONFIG.SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Device-ID': deviceId
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('‚è±Ô∏è Qu√° nhi·ªÅu y√™u c·∫ßu! Vui l√≤ng ƒë·ª£i 1 ph√∫t r·ªìi th·ª≠ l·∫°i.');
                    } else if (response.status === 403) {
                        throw new Error('üö´ Truy c·∫≠p b·ªã t·ª´ ch·ªëi! X√°c th·ª±c b·∫£o m·∫≠t th·∫•t b·∫°i. Vui l√≤ng ki·ªÉm tra l·∫°i.');
                    }
                    throw new Error(`‚ùå L·ªói server: ${response.status} Vui l√≤ng th·ª≠ l·∫°i sau.`);
                }
                
                const result = await response.json();

                if (result.success && result.data) {
                    updateButtonState('success', '<i class="fas fa-check"></i> TH√ÄNH C√îNG', 'fas fa-check');
                    document.getElementById('resultKey').innerText = result.data.key || 'ACTIVE-USER-' + deviceId.slice(-8);
                    document.getElementById('step-1').classList.add('hidden');
                    document.getElementById('step-2').classList.remove('hidden');
                    
                    securityState.csrfToken = generateCSRFToken();
                } else {
                    const errorMsg = result.error || "L·ªói kh√¥ng x√°c ƒë·ªãnh";
                    updateButtonState('error', '<i class="fas fa-exclamation-triangle"></i> L·ªñI', 'fas fa-exclamation-triangle');
                    showError(errorMsg);
                    setTimeout(() => {
                        updateButtonState('idle', '<i class="fas fa-redo"></i> TH·ª¨ L·∫†I', 'fas fa-redo');
                    }, 2000);
                    console.error('Request failed:', errorMsg);
                }
            } catch (error) {
                updateButtonState('error', '<i class="fas fa-exclamation-triangle"></i> L·ªñI K·∫æT N·ªêI', 'fas fa-exclamation-triangle');
                showError(error.message);
                setTimeout(() => {
                    updateButtonState('idle', '<i class="fas fa-redo"></i> TH·ª¨ L·∫†I', 'fas fa-redo');
                }, 2000);
                console.error('Request error:', error.message);
            }
        }

        // ===== CLIPBOARD FUNCTIONS =====
        function copyKeyToClipboard() {
            const keyText = document.getElementById('resultKey').innerText;
            if (keyText === '---') return;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(keyText).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopy(keyText);
                });
            } else {
                fallbackCopy(keyText);
            }
        }
        
        function showCopySuccess() {
            const copyBtn = event.target;
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i> ƒê√É SAO CH√âP!';
            copyBtn.style.backgroundColor = 'rgba(16, 185, 129, 0.2)';
            copyBtn.style.borderColor = 'rgba(16, 185, 129, 0.3)';
            copyBtn.style.color = '#34d399';
            
            setTimeout(() => {
                copyBtn.innerHTML = originalText;
                copyBtn.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                copyBtn.style.borderColor = 'rgba(59, 130, 246, 0.2)';
                copyBtn.style.color = '#60a5fa';
            }, 2000);
        }

        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert("‚úÖ ƒê√£ sao ch√©p m√£ Key!");
        }

        // ===== UTILITY FUNCTIONS =====
        function generateCSRFToken() {
            const randomBytes = new Uint8Array(32);
            crypto.getRandomValues(randomBytes);
            return btoa(String.fromCharCode(...randomBytes));
        }

        function generateRequestId() {
            return 'req_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ===== DEVICE FINGERPRINTING =====
        function getDeviceFingerprint() {
            let deviceId = localStorage.getItem('device_id');
            
            if (!deviceId) {
                let canvasHash = '';
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.textBaseline = 'top';
                        ctx.font = '14px Arial';
                        ctx.fillText('Device fingerprint', 2, 2);
                        canvasHash = canvas.toDataURL();
                    }
                } catch (e) {
                    canvasHash = crypto.randomUUID();
                }
                
                deviceId = 'DEVICE_' + btoa((canvasHash || 'fallback') + Date.now()).replace(/[^a-zA-Z0-9]/g, '').slice(0, 32);
                localStorage.setItem('device_id', deviceId);
            }
            
            return deviceId;
        }

        // ===== SECURITY PROTECTIONS =====
        document.addEventListener('mousemove', () => securityState.userInteractions.mouse++);
        document.addEventListener('keydown', () => securityState.userInteractions.keyboard++);

        document.addEventListener('contextmenu', e => e.preventDefault());

        document.addEventListener('keydown', e => {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
            }
        });

        window.addEventListener('load', () => {
            securityState.csrfToken = generateCSRFToken();
            
            // Initialize button state
            updateButtonState('idle', '<i class="fas fa-bolt"></i> NH·∫¨N M√É K√çCH HO·∫†T', 'fas fa-bolt');
            
            // Validate user input on page load
            if (!validateUserInput()) {
                console.warn('Invalid user input detected on page load');
            }
        });
    </script>
</body>
</html>

